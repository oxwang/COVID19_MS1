####Percentages of reads mapped to SARS-CoV-2, human, bacterial genome across sevensix protocols###


library("ggplot2")
library("scales")
library("ggpubr")
library("ggplotify")


mapping=read.csv("/.../",header=TRUE)

mapping$Species=factor(mapping$Species, levels=c("SARS-COV-2","Human","Bacteria"), ordered=TRUE)

p1 <- ggplot(mapping, aes(x=Protocol, y=Mapped.reads, fill=Condition))+
  geom_boxplot(aes(color=Condition),fill="white",varwidth = TRUE,outlier.shape = NA)+facet_wrap(~Species)+
  theme_bw(base_size = 10)+ylab("Mapped reads (%)")+
  scale_y_continuous(trans = pseudo_log_trans(base=10),breaks=c(0,5,25,50,75,100),labels=comma_format(accuracy = 0.01))+
  geom_dotplot(binaxis = 'y', stackdir = 'center',dotsize=25,binwidth=0.001,position = position_jitterdodge(jitter.width=0.2, dodge.width=0.8))+
  scale_fill_manual(values = c("#CC0000","#3300FF"))+scale_color_manual(values = c("#CC0000","#3300FF"))

p1


mapping$Viral_input2=factor(mapping$Viral_input2, levels=c("Low","High"), ordered=TRUE)


p2 <- ggplot(mapping, aes(x=Protocol, y=Mapped.reads, fill=Viral_input2))+
  expand_limits(y=0)+
  geom_boxplot(aes(color=Viral_input2),fill="white",varwidth=TRUE, outlier.shape=NA)+facet_wrap(~Species)+
  theme_bw(base_size = 10)+
  scale_y_continuous(trans = pseudo_log_trans(base=10),breaks=c(0,5,25,50,75,100),labels=comma_format(accuracy = 0.01))+
  ylab("Mapped reads (%)")+labs(color="Viral input")+
  geom_dotplot(binaxis = 'y', stackdir = 'center',dotsize=25,binwidth=0.001,position = position_jitterdodge(jitter.width=0.2, dodge.width=0.8))+
  guides(fill=guide_legend(title="Viral input"))+
  scale_fill_manual(values = c("#FF6600","#009933"))+scale_color_manual(values = c("#FF6600","#009933"))


p2

p1=as.grob(p1)
p2=as.grob(p2)

p_total=ggarrange(p1,p2,labels=c("a","b"), ncol=1,nrow = 2)

p_total
